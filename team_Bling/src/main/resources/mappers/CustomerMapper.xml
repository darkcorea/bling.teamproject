<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.project.bling.mapper.customerMapper">

	<!-- 상품 pidx의 문의 총 갯수 -->
	<select id="Prduct_Question_Count" parameterType="int" resultType="int">
		SELECT count(*)  AS questionCount FROM bg_product_question 
		WHERE pidx= #{pidx}
	</select>

	<!-- 상품 디테일에서 pidx로 문의한 내용 가져오기 -->
	<select id="Product_Question" parameterType="PageMaker" resultType="CombineVO">
		<![CDATA[
		SELECT * FROM 
		    ( SELECT rownum as rnum, A.* from
		        (SELECT bq.midx, bq.pqidx, bq.depth, bq.title, bq.comments, bg.uname, bq.rdate
				FROM bg_product_question bq
				JOIN bg_user bg ON bq.midx = bg.midx 
				WHERE pidx= #{pidx}
				ORDER BY bq.originpqidx desc, bq.depth asc) A 
		     WHERE rownum <= #{lastPost} ) B
	 	WHERE rnum >= #{startPost}
	 	]]>
	</select>
	  
	<!-- 상품 디테일에서 문의한 내용과 결과를 확인할 때 --> 
	<select id="product_pqidx" parameterType="Product_QuestionVO" resultType="Product_QuestionVO">
		SELECT title, comments, state FROM bg_product_question WHERE pwd=#{pwd} AND pqidx=#{pqidx}
	</select>  
	 
	 <!-- 상문 문의 하기 내용 등록 -->
	<insert id="product_write" parameterType="Product_QuestionVO" >
		INSERT INTO bg_product_question (pqidx, originpqidx, midx, pidx, title, comments, pwd,  rdate) 
		VALUES (pqidx_seq.nextval, pqidx_seq.nextval, #{midx}, #{pidx}, #{title}, #{comments}, #{pwd}, sysdate)
	</insert> 
	
	<!-- pqidx로 문의 내용 가져오기 -->
	<select id="product_question_one" parameterType="int" resultType="Product_QuestionVO">
		SELECT title, comments, pidx, pwd, pqidx FROM bg_product_question WHERE pqidx=#{pqidx}
	</select>
	
	<update id="product_modify" parameterType="Product_QuestionVO">
		UPDATE bg_product_question SET title=#{title}, comments=#{comments}, pwd=#{pwd}, rdate=sysdate
		WHERE pqidx = #{pqidx}
	</update>
	
	
</mapper>