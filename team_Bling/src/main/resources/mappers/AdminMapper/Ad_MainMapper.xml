<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.project.bling.mapper.adminmapper.ad_mainMapper">
	<!-- ad_delivery 뷰테이블 사용 -->
	<!-- 주문관리 -->
	<select id="order" resultType="DeliveryVO">
		select 
		count(if(deli_stat='N',deli_stat,null)) as deli_stat_n,
		count(if(deli_stat='Y',deli_stat,null)) as deli_stat_y,
		count(if(deli_stat='A',deli_stat,null)) as deli_stat_a,
		count(if(deli_stat='b',deli_stat,null)) as deli_stat_b,
		count(if(deli_stat='C',deli_stat,null)) as deli_stat_c,
		count(if(confirm_yn='N',confirm_yn,null)) as confirm_yn,
		count(if(refund='N',refund,null)) as refund,
		count(if(exchange='N',exchange,null)) as exchange
		from ad_delivery;
	</select>
	
	<!-- 문의답변 -->
	<!-- 상품문의 -->
	<select id="productq" resultType="int">
		select count(pqidx) from bg_product_question where state='N' and depth=0
	</select>
	
	<!-- 1:1문의 -->
	<select id="privateq" resultType="int">
		select count(qidx) from bg_question where state='N' and depth = 0
	</select>
	
	<!-- 기간별 매출현황 -->
	<!-- 최근 일주일 -->
	<select id="7tot" resultType="int">
		select ifnull(sum(tot_price),0) from bg_order where rdate between date_add(now(),interval -1 week) and now();
	</select>
	<!-- 최근 15일 -->
	<select id="15tot" resultType="int">
		select ifnull(sum(tot_price),0) from bg_order where rdate between date_add(now(),interval -15 day) and now();
	</select>
	<!-- 최근 30일 -->
	<select id="30tot" resultType="int">
		select ifnull(sum(tot_price),0) from bg_order where rdate between date_add(now(),interval -30 day) and now();
	</select>
	<!-- 오늘 기준 7일간 데이터 -->
	<select id="recenttot" resultType="int" parameterType="int">
		select ifnull(sum(tot_price),0) as tot_price from bg_order 
		where date(rdate) = curdate() -	#{day};
	</select>
	
	<!-- 환불 -->
	<select id="7ref" resultType="int">
		select ifnull(sum(tot_price),0) from refund where refund = 'Y' and rdate between date_add(now(),interval -1 week) and now()
	</select>
	<select id="15ref" resultType="int">
		select ifnull(sum(tot_price),0) from refund where refund = 'Y' and rdate between date_add(now(),interval -15 week) and now()
	</select>
	<select id="30ref" resultType="int">
		select ifnull(sum(tot_price),0) from refund where refund = 'Y' and rdate between date_add(now(),interval -30 week) and now()
	</select>
	<select id="recentref" resultType="int" parameterType="int">
		select ifnull(sum(tot_price),0) as tot_price from refund where date(rdate) = curdate() - #{day} and refund = 'Y'
	</select>
	
	
</mapper>	