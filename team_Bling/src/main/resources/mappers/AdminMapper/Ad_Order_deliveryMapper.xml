<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.project.bling.mapper.adminmapper.ad_order_deliveryMapper">
	<!-- 전체 주문 리스트(order_idx 내림차순) -->
	<select id="orderList" resultType="CombineVO">
		SELECT o.order_idx,
			   count(o.order_idx) AS 'orderCompCnt',
		       DATE_FORMAT(o.rdate,'%Y-%m-%d') AS 'rdate',
		       u.uname,
		       p.pidx,
		       p.pname,
		       substring_index(op.oname,'+',1) AS 'oname',
		       od.quantity,
		       o.tot_price,
		       o.payment,
		       o.order_yn,
		       o.delivery_yn
		FROM bg_product p
		LEFT JOIN bg_option op
		ON p.pidx=op.pidx
		
		LEFT JOIN bg_order_detail od
		ON op.oidx=od.oidx
		
		RIGHT JOIN bg_order o
		ON o.order_idx=od.order_idx
		
		JOIN bg_user u
		ON o.midx=u.midx
		
		GROUP BY o.order_idx
		ORDER BY o.order_idx
		DESC
	</select>

	<!-- 출고버튼(관리자 주문리스트에서 order 테이블의 delivery_yn 컬럼을 Y로 바꾸기 -->
	<update id="deliveryYN" parameterType="CombineVO">
		UPDATE bg_order
		<if test='delivery_yn == "N"'>SET delivery_yn='Y'</if>
		<if test='delivery_yn == "Y"'>SET delivery_yn='N'</if>
		WHERE order_idx=#{order_idx}
	</update>
</mapper>